<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <div class="container-fluid">
        <div class="row mt-3">
            <div class="col">
                <button id="sumBtn" type="button" class="btn btn-danger d-none">
                    合計
                </button>
                <button type="button" class="myBtn btn btn-outline-primary" data-name="高跟鞋" data-price="2000" data-img="21">
                    高跟鞋
                </button>
                <button type="button" class="myBtn btn btn-outline-secondary" data-name="馬克杯" data-price="1500" data-img="30">
                    馬克杯
                </button>
                <button type="button" class="myBtn btn btn-outline-success" data-name="筆電" data-price="4650" data-img="48">
                    筆電
                </button>
                <button type="button" class="myBtn btn btn-outline-danger" data-name="手機" data-price="20000" data-img="160">
                    手機
                </button>
                <button type="button" class="myBtn btn btn-outline-warning" data-name="船" data-price="40000" data-img="211">
                    船
                </button>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col">
                <button type="button" class="myBtn btn btn-outline-info" data-name="遊戲把手" data-price="2500" data-img="96" data-id="1">
                    遊戲把手
                </button>
                <button type="button" class="myBtn btn btn-outline-danger" data-name="車子" data-price="89000" data-img="133">
                    車子
                </button>
                <button type="button" class="myBtn btn btn-outline-dark" data-name="相機" data-price="3760" data-img="250">
                    相機
                </button>
                <button type="button" class="myBtn btn btn-outline-warning" data-name="鬧鐘" data-price="3500" data-img="175">
                    鬧鐘
                </button>
                <button type="button" class="myBtn btn  btn-outline-info" data-name="茶壺" data-price="8000" data-img="225">
                    茶壺
                </button>
            </div>
        </div>
    </div>

    <hr>
    <div class="container-fluid">
        <table class="table table-hover align-middle text-center">
            <thead>
                <tr>
                    <th width="15%">品名</th>
                    <th width="30%">明細</th>
                    <th width="" class="text-start">新增/刪除</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col">
                <div class="text-center">
                    合計: <span id="mySum" class="display-4">0</span> NT.
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        $(document).ready(function () {
            function sumFun() {
                console.log('sumBtn ok');
                let myTotal = $('.myTotal');
                let sum = 0;
                myTotal.each(function (index, value) {
                    console.log('index', index);
                    console.log('value', value);
                    sum = sum + Number($(value).text());
                });
                console.log('final sum ', sum);
                $('#mySum').text(sum);
            }

            function delFun(nowThis) {
                console.log('del ok');
                let nowTr = $(nowThis).closest('tr');
                nowTr.remove();
                sumFun();
            }

            function cloneFun(nowThis) {
                console.log('clone ok');
                let nowTr = $(nowThis).closest('tr');
                nowTr.clone(true).insertAfter(nowTr);
                sumFun();
            }

            function addProduct(name, price, imgUrl) {
                let content = `
                <tr>
                    <td>
                        <img  src="https://picsum.photos/id/${imgUrl}/230/200" alt="">
                    </td>
                    <td class="text-start">
                        ${name}
                        <br>
                        單價 <span>${price}</span>元
                        <div class="mb-3">
                            <label for="" class="form-label">數量</label>
                            <input type="number" class="quantity form-control" id="" max="20" min="1" value="1">
                        </div>
                        <hr>
                        小計: <span class="myTotal">${price}</span>
                    </td>
                    <td class="text-start">
                        <button type="button" class="cloneBtn btn btn-warning">Clone</button>
                        <button type="button" class="delBtn btn btn-warning">Del</button>
                    </td>
                </tr>
                `;

                $('tbody').append(content);

                let myQuantity = $('.quantity').last();

                $('.delBtn').last().click(function (e) {
                    delFun(this);
                });

                $('.cloneBtn').last().click(function (e) {
                    cloneFun(this);
                });

                myQuantity.change(function (e) {
                    let getQuantity = Number($(this).val());
                    let closestQuantityTr = $(this).closest('tr');
                    let findTotal = closestQuantityTr.find('.myTotal');
                    console.log('closestQuantityTr', closestQuantityTr);
                    console.log('getQuantity', getQuantity);
                    let total = getQuantity * price;
                    console.log('total', total);
                    findTotal.text(total);

                    sumFun();
                });
            }

            const myBtn = $('.myBtn');

            myBtn.click(function (e) {
                let name = $(this).data('name');
                let price = $(this).data('price');
                let imgUrl = $(this).data('img');

                addProduct(name, price, imgUrl);
                sumFun();
            });
        });
    </script>
</body>

</html>
